{"version":3,"sources":["../src/worker.ts"],"sourcesContent":["/// <reference types=\"@better-typescript-lib/webworker\" />\n\nconst workerThis: DedicatedWorkerGlobalScope = globalThis as unknown as DedicatedWorkerGlobalScope;\n\nconst bc = new BroadcastChannel(\"test_channel\");\nbc.onmessage = (event) => {\n  console.log(\"BroadcastChannel: \");\n  console.log(event.data);\n}\n\nworkerThis.onmessage = (event) => {\n  console.log(event.data);\n  workerThis.postMessage(\"Hello from worker!\");\n\n  const memory = new WebAssembly.Memory({ initial: 1, maximum: 1, shared: true });\n  const buffer = memory.buffer;\n  const view = new Int32Array(buffer);\n\n  console.log(\"worker thread is going to sleep!!\");\n\n  (async () => {\n    console.log(\"worker thread is sleeping...\");\n\n    await new Promise((resolve) => setTimeout(resolve, 1000));\n\n    console.log(\"worker thread woke up!\");\n\n    Atomics.store(view, 0, 66);\n    Atomics.notify(view, 0, 1);\n  })();\n\n  Atomics.store(view, 0, 42);\n  while (true) {\n    if (Atomics.wait(view, 0, 42, 1000) === \"timed-out\") {\n      console.log(\"Worker thread is still sleeping...\");\n    } else {\n      break;\n    }\n  }\n\n  console.log(\"Main thread woke up!\");\n}\n"],"names":["workerThis","globalThis","bc","BroadcastChannel","onmessage","event","console","log","data","postMessage","memory","WebAssembly","Memory","initial","maximum","shared","buffer","view","Int32Array","Promise","resolve","setTimeout","Atomics","store","notify","wait"],"mappings":"AAEA,MAAMA,WAAyCC,WAE/C,MAAMC,GAAK,IAAIC,iBAAiB,eAChCD,CAAAA,GAAGE,SAAS,CAAG,AAACC,QACdC,QAAQC,GAAG,CAAC,sBACZD,QAAQC,GAAG,CAACF,MAAMG,IAAI,CACxB,CAEAR,CAAAA,WAAWI,SAAS,CAAG,AAACC,QACtBC,QAAQC,GAAG,CAACF,MAAMG,IAAI,EACtBR,WAAWS,WAAW,CAAC,sBAEvB,MAAMC,OAAS,IAAIC,YAAYC,MAAM,CAAC,CAAEC,QAAS,EAAGC,QAAS,EAAGC,OAAQ,IAAK,GAC7E,MAAMC,OAASN,OAAOM,MAAM,CAC5B,MAAMC,KAAO,IAAIC,WAAWF,QAE5BV,QAAQC,GAAG,CAAC,qCAEZ,AAAC,CAAA,UACCD,QAAQC,GAAG,CAAC,+BAEZ,OAAM,IAAIY,QAAQ,AAACC,SAAYC,WAAWD,QAAS,MAEnDd,QAAQC,GAAG,CAAC,0BAEZe,QAAQC,KAAK,CAACN,KAAM,EAAG,IACvBK,QAAQE,MAAM,CAACP,KAAM,EAAG,EAC1B,CAAA,IAEAK,QAAQC,KAAK,CAACN,KAAM,EAAG,IACvB,MAAO,KAAM,CACX,GAAIK,QAAQG,IAAI,CAACR,KAAM,EAAG,GAAI,OAAU,YAAa,CACnDX,QAAQC,GAAG,CAAC,qCACd,KAAO,CACL,KACF,CACF,CAEAD,QAAQC,GAAG,CAAC,uBACd"}